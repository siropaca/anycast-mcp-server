# Anycast MCP Server - Claude Code 向けガイド

## ドキュメント

| ファイル | 説明 |
|----------|------|
| [docs/specs/tool-design.md](docs/specs/tool-design.md) | MCP ツール設計仕様書 |
| [docs/adr/](docs/adr/) | Architecture Decision Records |

## ドキュメント管理ルール

- README.md から読み取れる情報は CLAUDE.md に重複して記載しない
- ADR を追加した際は `docs/adr/README.md` の一覧にも追記する

## プロジェクト概要

anycast-backend の REST API を MCP ツールとしてラップするサーバー。
Claude Code エージェントがチャンネル作成・エピソード作成などの操作を行えるようにする。

### 対象 API

- ベース URL: 環境変数 `ANYCAST_BASE_URL`
- 認証: 環境変数 `ANYCAST_API_KEY` を `X-API-Key` ヘッダーに設定
- API 仕様: anycast-backend の Swagger ドキュメントを参照

## 開発規約

### 基本姿勢

- ユーザーの指示であっても、設計として良くないものや一般的でないものがあれば、修正を実行する前に確認を入れる
- 常にメンテナビリティやテスタビリティを意識した実装を心がける

### テスト

- 外部依存のないユニットテストは、実装時に必ず作成する

### パッケージ管理

- ランタイムは Node.js を使用する
- Node.js のバージョンは mise で管理する（`.mise.toml`）

### コーディング規約

- TypeScript の strict モードを有効にする
- 名前付き関数は `function` 宣言を使う
- コールバック引数にはアロー関数を使う
- ソースコードには日本語でコメントを残す（細かすぎず適切に）
- エラーハンドリングは適切に行い、エージェントにわかりやすいメッセージを返す

### MCP ツール実装ガイド

#### ツール追加の流れ

1. **設計**: `docs/specs/tool-design.md` にツール仕様を追加
2. **HTTP クライアント**: `src/client.ts` に API 呼び出しメソッドを追加
3. **ツール定義**: `src/tools/` にツールを定義（スキーマ + ハンドラー）
4. **登録**: `src/index.ts` でツールを登録
5. **テスト**: ユニットテストを作成

#### ツール設計の原則

- 最小権限: 必要な操作のみツール化する（削除系は提供しない）
- 自己完結性: 各ツールは入力パラメータだけで動作する
- 発見可能性: 一覧取得ツールで ID を取得できるようにする
- エラー透過性: API のエラーメッセージをそのままエージェントに返す

### Git / GitHub

- ユーザーから指示があるまでコミットやプッシュを行わない
- ブランチを新規作成する際は、必ずユーザーに確認を取ってから作成する
- PR 作成時は `.github/PULL_REQUEST_TEMPLATE.md` をテンプレートとして使用する

## 用語

| 英語 | 日本語 |
|------|--------|
| Channel | チャンネル（ポッドキャストのチャンネル） |
| Episode | エピソード（チャンネル内の各回） |
| Character | キャラクター（チャンネルの登場人物） |
| Voice | ボイス（TTS の音声設定） |
| Category | カテゴリ（チャンネルの分類） |
| Script | 台本 |

## 学習事項

このセクションには、実装中にユーザーから指摘された内容のうち、今後の実装に役立つものを抽象化して記載する。具体的なケースではなく、同様の状況に適用できる一般的なルールとして記述すること。
